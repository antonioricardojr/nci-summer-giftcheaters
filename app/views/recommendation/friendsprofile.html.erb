<% provide(:title, @friend_profile["first_name"]+"&#39;s interests") %>
<section id="welcome">
	<br><br>
	<div class="container">
		<div class="row">
			<div class="col-lg-2 text-center"></div>
			<div class="col-lg-8 text-center">
				<h3><%= @friend_profile["first_name"] %>&#39;s Interests</h3>
				<hr class="star-primary">
				<p>Those are <%= @friend_profile["gender"]=="female"  ? 'her' : 'his' %> interests, please choose one category to get gift recommendations.</p>
				<br>
				<!--<%= @friend_likes%> -->

				<% 	movies = Array.new
				books = Array.new
				musics = Array.new
				authors = Array.new
				actdircs = Array.new

				@friend_likes.each do |like| 
					case like["category"]
					when "Movie"
						movies.push(like["id"] => like["name"])
					when "Book"
						books.push(like["id"] => like["name"])
					when "Musician/band"
						musics.push(like["id"] => like["name"])
					when "Author"
						authors.push(like["id"] => like["name"])
					when "Actor/director"
						actdircs.push(like["id"] => like["name"])
						end %>				
						<% end %>
					<div>
			<% @friend_likes_filtered.each do |like| %>
 					<p>
 						<%= link_to "#{like['category']}" , "/search/#{like['category']}" %>
 					</p>	
 					<p> <%= like %> </p>
 				
 				<% end %>
 			</div>

						<div id="piechart-placeholder"></div>

					</div> <!-- /col-lg-6 text-center -->
					<div class="col-lg-2 text-center"></div>
				</div> <!-- /row -->
			</div> <!-- /container -->
		</section>

			


		<%= render( :partial => 'layouts/jsincludepiechart.html', :formats => [:html]) %>

		<script type="text/javascript">
			$(function() {  
				var data = [
				{ label: "Movie",  data: <%= movies.length %>, color: "#48CA3B", url: ""},
				{ label: "Book",  data: <%= books.length %>, color: "#00BCE1", url: "http://stackoverflow.com"},
				{ label: "Musician/band",  data: <%= musics.length %>, color: "#4D3A7D", url: "http://google.com"},
				{ label: "Author",  data: <%= authors.length %>, color: "#AD1D28", url: "http://facebook.com"},
				{ label: "Actor/director",  data: <%= actdircs.length %>, color: "#DEBB27", url: "http://twitter.com"}
				];

				function labelFormatter(label, series) {
 				   return "<div style='font-size:8pt; text-align:center; padding:2px; color:white;'>"    + label + "<br/>" + series.data[0][1] + "%</div>";
				}

				var placeholder = $('#piechart-placeholder').css({'width':'70%' , 'min-height':'150px'});
				$.plot(placeholder, data, {

					series: {
						pie: {
							show: true,
							tilt:0.8,
							highlight: {
								opacity: 0.25
							},
							stroke: {
								color: '#fff',
								width: 2
							},
							startAngle: 2

						}
					},
					legend: {
						show: true,
						position: "ne", 
						labelBoxBorderColor: null,
						margin:[-30,15]
					},
					grid: {
						hoverable: true,
						clickable: true
					},
			        tooltip: true, //activate tooltip
			        tooltipOpts: {
			        	content: "%s : %y.1",
			        	shifts: {
			        		x: -30,
			        		y: -50
			        	}
			        }

    		});


				var $tooltip = $("<div class='tooltip top in' style='display:none;'><div class='tooltip-inner'></div></div>").appendTo('body');
				placeholder.data('tooltip', $tooltip);
				var previousPoint = null;

				placeholder.on('plothover', function (event, pos, item) {
					if(item) {
						if (previousPoint != item.seriesIndex) {
							previousPoint = item.seriesIndex;
							var tip = item.series['label'] + " : " + item.series['percent']+'%';
							$(this).data('tooltip').show().children(0).text(tip);
						}
						$(this).data('tooltip').css({top:pos.pageY + 10, left:pos.pageX + 10});
					} else {
						$(this).data('tooltip').hide();
						previousPoint = null;
					}

				});
			});

</script>